(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{135:function(e,a,t){e.exports=t(253)},183:function(e,a,t){},184:function(e,a,t){},185:function(e,a,t){},242:function(e,a,t){},250:function(e,a,t){},253:function(e,a,t){"use strict";t.r(a);var n,o,i,r=t(1),s=t.n(r),c=t(4),l=t.n(c),d=t(13),u=t(14),p=t(21),h=t(20),y=t(26),m=t(22),g=t(36),b=t(93),f=t(259),v=(t(140),t(76)),w=t(100),C=t(37),j=t.n(C),k=(t(141),t(123)),O=t.n(k),E=(t(169),t(124)),S=t.n(E),M="pk.eyJ1IjoiY21kYWxiZW0iLCJhIjoiY2pnbXhjZnplMDJ6MjMzbnk0OGthZGE1ayJ9.n1flNO8ndRYKQcR9wNIT9w",x=-43.109811,D=-22.8948963,L=(t(183),S()({accessToken:M})),A=function(e){function a(e){var t;return Object(d.a)(this,a),(t=Object(p.a)(this,Object(h.a)(a).call(this,e))).onMapMoved=t.onMapMoved.bind(Object(y.a)(t)),t}return Object(m.a)(a,e),Object(u.a)(a,[{key:"showPopup",value:function(e){console.debug(e.features[0]);var a=e.lngLat,t=e.features[0].properties,i=this.props.layers.find(function(a){return a.id===e.features[0].layer.id.split("--")[0]}),r="";t.name?r+="<h2>".concat(t.name,"</h2>"):r+="<i>Sem nome</i>",r+="<p>Tipo: <b>".concat(i.name,"</b></p>"),r+='\n            <a\n                target="_BLANK"\n                rel="noopener"\n                href="https://www.openstreetmap.org/'.concat(t.id,'"\n            >\n                Editar no OSM\n            </a>\n    '),o.setLngLat(a).setHTML(r).addTo(n)}},{key:"hidePopup",value:function(){o.remove()}},{key:"getCurrentBBox",value:function(){if(n){var e=n.getBounds().getSouthWest(),a=n.getBounds().getNorthEast();return"".concat(e.lat,",").concat(e.lng,",").concat(a.lat,",").concat(a.lng)}return"-23.036345361742164,-43.270405878917785,-22.915284125684607,-43.1111041211104"}},{key:"onMapMoved",value:function(){var e=this,a=n.getCenter().lat,t=n.getCenter().lng,o=n.getZoom();L.reverseGeocode({query:[t,a],types:["place"],limit:1}).send().then(function(n){var i=n.body,r={lat:a,lng:t,zoom:o};console.debug("onMapMoved",i.features),i.features&&i.features[0]&&(r.area=i.features[0].place_name),e.props.onMapMoved(r)}).catch(function(e){console.error(e.message)})}},{key:"addDynamicLayer",value:function(e){var a=this,t=["any"].concat(Object(w.a)(e.filters.map(function(e){return"string"===typeof e[0]?["==",["get",e[0]],e[1]]:["all"].concat(Object(w.a)(e.map(function(e){return["==",["get",e[0]],e[1]]})))})));e.style.borderColor?(n.addLayer({id:e.id+"--border",type:"line",source:"osm",name:e.name,description:e.description,paint:Object(v.a)({"line-color":e.style.borderColor,"line-width":["case",["boolean",["feature-state","highlight"],!1],12,e.style.lineWidth]},"dashed"===e.style.borderStyle&&{"line-dasharray":[1,.6]}),filter:t}),n.addLayer({id:e.id,type:"line",source:"osm",name:e.name,description:e.description,paint:Object(v.a)({"line-color":e.style.lineColor,"line-width":["case",["boolean",["feature-state","highlight"],!1],12,e.style.lineWidth-e.style.borderWidth]},"dashed"===e.style.lineStyle&&{"line-dasharray":[1,.6]}),filter:t})):n.addLayer({id:e.id,type:"line",source:"osm",name:e.name,description:e.description,paint:Object(v.a)({"line-color":e.style.lineColor,"line-width":["case",["boolean",["feature-state","highlight"],!1],12,e.style.lineWidth]},"dashed"===e.style.lineStyle&&{"line-dasharray":[1,.6]}),filter:t});var o=e.style.borderColor?e.id+"--border":e.id;n.on("mouseenter",o,function(e){e.features.length>0&&(n.getCanvas().style.cursor="pointer")}),n.on("mouseleave",o,function(e){n.getCanvas().style.cursor=""}),n.on("click",o,function(e){e.features.length>0&&(i&&n.setFeatureState({source:"osm",id:i},{highlight:!1}),i=e.features[0].id,n.setFeatureState({source:"osm",id:i},{highlight:!0}),a.showPopup(e))})}},{key:"initLayers",value:function(){var e=this;n.addSource("osm",{type:"geojson",data:this.props.data||{type:"FeatureCollection",features:[]},generateId:!0}),this.props.layers.slice().reverse().forEach(function(a){e.addDynamicLayer(a)})}},{key:"componentDidUpdate",value:function(e){n&&n.getSource("osm")&&(this.props.data!==e.data&&n.getSource("osm").setData(this.props.data),this.props.style!==e.style&&n.setStyle(this.props.style),this.props.center!==e.center&&n.setCenter(this.props.center),this.props.layers.map(function(e){return e.isActive}).join()===e.layers.map(function(e){return e.isActive}).join()&&this.props.layers.forEach(function(e){n.setLayoutProperty(e.id,"visibility",e.isActive?"visible":"none"),e.style.borderColor&&n.setLayoutProperty(e.id+"--border","visibility",e.isActive?"visible":"none")}))}},{key:"componentDidMount",value:function(){var e=this;j.a.accessToken=M,(n=new j.a.Map({container:this.mapContainer,style:this.props.style,center:this.props.center,zoom:this.props.zoom})).addControl(new j.a.NavigationControl({showCompass:!1}),"bottom-right"),n.addControl(new j.a.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),"bottom-right"),n.addControl(new O.a({accessToken:j.a.accessToken,mapboxgl:j.a,countries:"br",language:"pt-br"}),"top-left"),n.on("load",function(){e.initLayers(),e.onMapMoved(),n.on("moveend",e.onMapMoved),n.on("style.load",function(){e.initLayers(),e.onMapMoved()})}),(o=new j.a.Popup({closeOnClick:!1})).on("close",function(e){i&&n.setFeatureState({source:"osm",id:i},{highlight:!1}),i=null})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{ref:function(a){return e.mapContainer=a}})}}]),a}(r.Component),z=(t(184),function(e){function a(){return Object(d.a)(this,a),Object(p.a)(this,Object(h.a)(a).apply(this,arguments))}return Object(m.a)(a,e),Object(u.a)(a,[{key:"render",value:function(){var e=this.props.area.split(","),a=e[0],t=e[1];e[2];return s.a.createElement("div",{id:"spinner",className:"loader-container"},s.a.createElement("div",{className:"loader"},s.a.createElement("svg",{className:"spinnersvg",viewBox:"25 25 50 50"},s.a.createElement("circle",{className:"path",cx:"50",cy:"50",r:"20",fill:"none",strokeWidth:"6",strokeMiterlimit:"10"})),s.a.createElement("div",{className:"content"},s.a.createElement("h2",null,"Carregando mapa ciclovi\xe1rio de ",s.a.createElement("b",null,a," (",t,")")),s.a.createElement("div",null,"Como \xe9 a primeira vez que voc\xea carrega esta \xe1rea do OSM pode demorar um pouquinho :)"))))}}]),a}(r.Component)),W=t(257),N=t(59),_=t(254),J=t(9),I=(t(185),function(e){function a(){return Object(d.a)(this,a),Object(p.a)(this,Object(h.a)(a).apply(this,arguments))}return Object(m.a)(a,e),Object(u.a)(a,[{key:"info",value:function(){W.a.info({title:"Sobre",content:s.a.createElement("p",null,"A plataforma BICIMAPA \xe9 uma ferramenta que buscar ampliar a visibilidade das infraestruturas ciclovi\xe1rias mapeadas no OpenStreetMap e engajar uma comunidade de mapeadores para atualiza\xe7\xe3o colaborativa de dados e incid\xeancia em pol\xedticas p\xfablicas de mobilidade urbana."),onOk:function(){}})}},{key:"render",value:function(){var e=this.props.title.split(","),a=e[0],t=e[1];e[2];return s.a.createElement("div",{className:"topbar",style:{height:64}},s.a.createElement("div",null,s.a.createElement("h1",{className:"logo"},"BICIMAPA")),s.a.createElement("h2",{className:"city"},s.a.createElement("span",{className:"state"},t),a),s.a.createElement("div",null,s.a.createElement(N.a,{type:"link",onClick:this.info},"Sobre"),s.a.createElement(_.a,{type:"vertical"}),s.a.createElement(N.a,{type:"link",onClick:this.props.downloadData},s.a.createElement(J.a,{type:"download"})," Baixar dados")))}}]),a}(r.Component)),P=t(256),B=P.a.Option,R=function(e){function a(){return Object(d.a)(this,a),Object(p.a)(this,Object(h.a)(a).apply(this,arguments))}return Object(m.a)(a,e),Object(u.a)(a,[{key:"onChange",value:function(e){this.props.onMapStyleChange(e)}},{key:"render",value:function(){return s.a.createElement(P.a,{defaultValue:"Mapa light",optionFilterProp:"children",onChange:this.onChange.bind(this),style:{position:"fixed",bottom:"32px",right:"50px",width:"160px"}},s.a.createElement(B,{value:"mapbox://styles/cmdalbem/cjxseldep7c0a1doc7ezn6aeb"},"Mapa light"),s.a.createElement(B,{value:"mapbox://styles/mapbox/streets-v11"},"Mapa normal"),s.a.createElement(B,{value:"mapbox://styles/cmdalbem/cjgmxgkbw000n2rqtucat5zjz"},"Dorsia"),s.a.createElement(B,{value:"mapbox://styles/cmdalbem/cjxsdwb907bfi1cqevxio2bst"},"Mapa com sat\xe9lite"))}}]),a}(r.Component),F=t(258),q=t(255),T=(t(242),function(e){function a(){return Object(d.a)(this,a),Object(p.a)(this,Object(h.a)(a).apply(this,arguments))}return Object(m.a)(a,e),Object(u.a)(a,[{key:"onChange",value:function(e,a){this.props.onLayersChange(e,a)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"layers-panel"},this.props.layers&&this.props.layers.map(function(a){return s.a.createElement(F.a,{placement:"left",title:a.description,arrowPointAtCenter:!0},s.a.createElement("div",{key:a.name,className:"layer-row",onClick:e.onChange.bind(e,a.id,!a.isActive)},s.a.createElement("div",null,s.a.createElement("span",{className:"layer-miniature",style:{height:2*a.style.lineWidth,background:"solid"===a.style.lineStyle?a.style.lineColor:"repeating-linear-gradient(90deg, ".concat(a.style.lineColor,", ").concat(a.style.lineColor," 3px, white 3px, white 6px)"),borderColor:a.style.borderColor,borderStyle:a.style.borderStyle,borderWidth:a.style.borderWidth?a.style.borderWidth/2:"0",borderLeft:"none",borderRight:"none"}}),s.a.createElement("span",{className:"layer-name"},a.name)),s.a.createElement(q.a,{size:"small",checked:a.isActive})))}))}}]),a}(r.Component)),U=t(132),G=t.n(U),V=t(96),Y=t.n(V);var Z=t(75),Q=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,null,[{key:"getQuery",value:function(e){var a=e.bbox,t=e.areaId,n=Z.map(function(e){return e.filters.map(function(e){return"way"+("string"===typeof e[0]?'["'.concat(e[0],'"="').concat(e[1],'"]'):e.map(function(e){return'["'.concat(e[0],'"="').concat(e[1],'"]')}).join(""))+(a?"(".concat(a,");\n"):"(area.a);\n")}).join("")}).join("");return"\n            [out:json][timeout:500];\n            ".concat(!a&&"area(".concat(t,")->.a;"),"\n            (\n                ").concat(n,"\n            );\n            out body geom;\n        ")}},{key:"massageLayersData",value:function(){return Z.forEach(function(e){e.style.lineStyle=e.style.lineStyle||"solid",e.isActive=void 0===e.isActive||e.isActive,e.style.borderColor&&(e.style.borderStyle=e.style.borderStyle||"solid",e.style.borderWidth=e.style.borderWidth||3),e.id=function(e){var a="\xe0\xe1\xe4\xe2\xe3\xe5\u0103\xe6\xe7\xe8\xe9\xeb\xea\u01f5\u1e27\xec\xed\xef\xee\u1e3f\u0144\u01f9\xf1\xf2\xf3\xf6\xf4\u0153\xf8\u1e55\u0155\xdf\u015b\u0219\u021b\xf9\xfa\xfc\xfb\u01d8\u1e83\u1e8d\xff\u017a\xb7/_,:;",t=new RegExp(a.split("").join("|"),"g");return e.toString().toLowerCase().replace(/\s+/g,"-").replace(t,function(e){return"aaaaaaaaceeeeghiiiimnnnooooooprssstuuuuuwxyz------".charAt(a.indexOf(e))}).replace(/&/g,"-and-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}(e.name)}),Z}},{key:"getLayers",value:function(){return this.massageLayersData()}},{key:"getData",value:function(a){return new Promise(function(t,n){var o;Y.a.getJSON("https://nominatim.openstreetmap.org/search?format=json&q=".concat(encodeURI(a.area)),function(a){console.debug("nominatimData",a);var i=36e8+a[0].osm_id,r=e.getQuery({areaId:i});console.debug("generated query: ",r);var s=encodeURI(r);Y.a.getJSON("https://overpass.kumi.systems/api/interpreter?data=".concat(s),function(e){console.debug("osm data: ",e),o=G()(e,{flatProperties:!0}),console.debug("converted to geoJSON: ",o),t({geoJson:o})}).fail(function(e){console.error("Deu erro! Saca s\xf3:",e),f.a.error({message:"Erro",description:"Ops, erro na API do Overpass. Abra o console para ver mais detalhes."}),n()})}).fail(function(e){console.error("Deu erro! Saca s\xf3:",e),f.a.error({message:"Erro",description:"Ops, erro na API do Nominatim. Abra o console para ver mais detalhes."}),n()})})}}]),e}(),H=(t(250),function(e){function a(e){var t;Object(d.a)(this,a),(t=Object(p.a)(this,Object(h.a)(a).call(this,e))).updateData=t.updateData.bind(Object(y.a)(t)),t.onMapStyleChange=t.onMapStyleChange.bind(Object(y.a)(t)),t.onMapMoved=t.onMapMoved.bind(Object(y.a)(t)),t.onLayersChange=t.onLayersChange.bind(Object(y.a)(t)),t.downloadData=t.downloadData.bind(Object(y.a)(t));var n=t.getParamsFromURL();return t.state={geoJson:null,loading:!1,layers:Q.getLayers(),mapStyle:"mapbox://styles/cmdalbem/cjxseldep7c0a1doc7ezn6aeb",zoom:n.z||13,area:"Niter\xf3i, Rio De Janeiro, Brazil",center:[n.lng||x,n.lat||D]},t.state.area&&t.updateData(),t}return Object(m.a)(a,e),Object(u.a)(a,[{key:"getParamsFromURL",value:function(){var e=new URLSearchParams(this.props.location.search),a={};return["z","lat","lng"].forEach(function(t){var n=e.get(t);n&&(a[t]=n)}),a}},{key:"isDataFresh",value:function(e){return new Date-new Date(e.updatedAt)<6048e5}},{key:"updateData",value:function(){var e=this;this.state.zoom>10&&this.state.area?Object(b.a)(this.state.area).then(function(a){console.debug("IndexedDB result:",a),a&&e.isDataFresh(a)?(console.debug("IndexedDB data is fresh."),e.setState({geoJson:a.geoJson})):(console.debug("Couldn't find data for area ".concat(e.state.area," or it isn't fresh, hitting OSM...")),e.setState({loading:!0}),Q.getData({area:e.state.area}).then(function(a){Object(b.b)(e.state.area,{geoJson:a.geoJson,updatedAt:new Date}),e.setState({geoJson:a.geoJson,loading:!1})}))}).catch(function(e){f.a.error({message:"Erro",description:"Ocorreu um erro ao tentar recuperar os dados salvos no IndexedDB."})}):this.setState({loading:!1})}},{key:"onMapStyleChange",value:function(e){this.setState({mapStyle:e})}},{key:"onLayersChange",value:function(e,a){var t=Object.assign([],this.state.layers);t.filter(function(a){return a.id===e})[0].isActive=a,this.setState({layers:t})}},{key:"downloadData",value:function(){!function(e,a){var t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",a+".json"),document.body.appendChild(n),n.click(),n.remove()}(this.state.geoJson,"mapa-cicloviario-".concat(this.state.area))}},{key:"componentDidUpdate",value:function(e,a){if(this.props.location!==e.location&&this.onRouteChanged(),this.state.area!==a.area&&(console.debug("Changed area from ".concat(a.area," to ").concat(this.state.area)),this.updateData()),this.state.zoom!==a.zoom||this.state.lat!==a.lat||this.state.lng!==a.lng){var t="?";t+="lat=".concat(this.state.lat.toFixed(7)),t+="&lng=".concat(this.state.lng.toFixed(7)),t+="&z=".concat(this.state.zoom.toFixed(2)),this.props.history.push({search:t})}}},{key:"onRouteChanged",value:function(){}},{key:"onMapMoved",value:function(e){this.setState(e)}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(I,{title:this.state.area,downloadData:this.downloadData}),s.a.createElement(A,{data:this.state.geoJson,layers:this.state.layers,style:this.state.mapStyle,zoom:this.state.zoom,center:this.state.center,updateData:this.updateData,onMapMoved:this.onMapMoved}),s.a.createElement(R,{onMapStyleChange:this.onMapStyleChange}),s.a.createElement(T,{layers:this.state.layers,onLayersChange:this.onLayersChange}),this.state.loading&&s.a.createElement(z,{area:this.state.area}))}}]),a}(r.Component)),K=Object(g.d)(H);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var $=t(92);l.a.render(s.a.createElement($.a,null,s.a.createElement(K,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},75:function(e){e.exports=[{name:"Ciclovia",description:"Espa\xe7o segregado para fluxo de bicicletas que pode ser implementados com ou sem desn\xedvel com rela\xe7\xe3o \xe0 via e como elemento f\xedsico delimitador ou outras medidas de segrega\xe7\xe3o como ilhas e/ou cal\xe7adas, elementos de confinamento prefabricados, faixas separadoras, vegeta\xe7\xe3o, \xe1reas verdes ou ainda \xe1rea de estacionamento adjacente.",filters:[["highway","cycleway"],["cycleway","track"],["cycleway:left","track"],["cycleway:right","track"],["cycleway","opposite_track"],["cycleway:left","opposite_track"],["cycleway:right","opposite_track"]],style:{lineColor:"#65df97",lineWidth:6,borderColor:"#4ba96e",borderStyle:"solid"}},{name:"Ciclofaixa",description:"Espa\xe7o sem segrega\xe7\xe3o f\xedsica destinado exclusivamente \xe0 circula\xe7\xe3o de bicicletas delimitada por marcas no pavimento e, ocasionalmente, alguns elementos delimitadores como tachas ou tach\xf5es retrorrefletivos.",filters:[["cycleway","lane"],["cycleway:left","lane"],["cycleway:right","lane"],["cycleway:both","lane"],["cycleway","opposite_lane"],["cycleway:right","opposite_lane"],["cycleway:left","opposite_lane"]],style:{lineColor:"#b4fad0",lineWidth:5,borderColor:"#69b991",borderStyle:"solid"}},{name:"Ciclorota",description:"Via com sinaliza\xe7\xe3o para o tr\xe1fego compartilhado com v\xe9iculos motorizados, com prefer\xeancia para bicicletas.",filters:[["cycleway","buffered_lane"],["cycleway:left","buffered_lane"],["cycleway:right","buffered_lane"],["cycleway","shared_lane"],["cycleway:left","shared_lane"],["cycleway:right","shared_lane"],["cycleway","share_busway"],["cycleway:left","share_busway"],["cycleway:right","share_busway"],["cycleway","opposite_share_busway"]],style:{lineColor:"#f8c9ae",lineWidth:4,borderColor:"#398371",borderWidth:2}},{name:"Cal\xe7ada compartilhada",description:"Cal\xe7ada com sinaliza\xe7\xe3o para circula\xe7\xe3o de bicicletas compartilhada em que pedestres possuem a prioridade.",filters:[[["highway","footway"],["bicycle","designated"]],[["highway","pedestrian"],["bicycle","designated"]],[["highway","pedestrian"],["bicycle","yes"]],["cycleway","sidepath"],["cycleway:left","sidepath"],["cycleway:right","sidepath"],["bicycle","use_sidepath"]],style:{lineColor:"#f8c9ae",lineWidth:4,borderColor:"#f0763a",borderWidth:2}},{name:"Baixa velocidade",description:"Vias com limite de velocidade regulamentada de at\xe9 30km/h.",isActive:!1,filters:[["maxspeed","30"],[["highway","living_street"],["bicycle","yes"]],[["highway","unclassified"],["bicycle","yes"]]],style:{lineColor:"orange",lineWidth:2,lineStyle:"dashed"}},{name:"Trilha",description:"Caminhos geralmente n\xe3o pavimentados com acesso permitido ou destinado a bicicleta.",isActive:!1,filters:[[["highway","track"],["bicycle","designated"]],[["highway","track"],["bicycle","yes"]],[["highway","path"],["bicycle","designated"]],[["highway","path"],["bicycle","yes"]]],style:{lineColor:"#996633",lineWidth:2,lineStyle:"dashed"}},{name:"Proibido",description:"Vias onde expressamente n\xe3o \xe9 permitido passar de bicicleta.",isActive:!1,filters:[["bicycle","no"],["bicycle","dismount"]],style:{lineColor:"red",lineWidth:2,lineStyle:"dashed"}}]}},[[135,1,2]]]);
//# sourceMappingURL=main.ae75912f.chunk.js.map