{"version":3,"sources":["img/itdp.png","img/ucb.png","img/logo_green.svg","img/normal.png","img/satelite.png","constants.js","Map.js","Spinner.js","CitySwitcherBackdrop.js","utils.js","TopBar.js","MapStyleSwitcher.js","LayersPanel.js","OSMController.js","geojsonUtils.js","Storage.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","__webpack_require__","p","MAPBOX_ACCESS_TOKEN","DEFAULT_LNG","DEFAULT_LAT","DEFAULT_ZOOM","IS_MOBILE","window","matchMedia","concat","matches","geocodingClient","mbxGeocoding","accessToken","Map","props","_this","Object","classCallCheck","this","_super","call","onMapMoved","bind","assertThisInitialized","e","coords","lngLat","features","properties","layer","layers","find","l","id","split","html","name","style","lineColor","popup","setLngLat","setHTML","addTo","map","hoverPopup","remove","sw","getBounds","getSouthWest","ne","getNorthEast","lat","lng","_this2","console","debug","setMaxBounds","reverseGeocode","query","types","limit","send","then","response","body","place","searchBar","setBbox","bbox","area","place_name","catch","err","error","message","getCenter","zoom","getZoom","toConsumableArray","filters","f","f2","_this3","getMapboxFilterForLayer","borderColor","addLayer","type","source","description","layout","line-join","line-cap","paint","objectSpread2","line-color","line-width","lineWidth","borderStyle","line-dasharray","filter","borderWidth","lineStyle","interactiveId","on","length","getCanvas","cursor","hoveredCycleway","setFeatureState","hover","selectedCycleway","showPopup","_this4","lengths","forEach","querySourceFeatures","turfLength","updateLengths","_this5","setLayoutProperty","showSatellite","addSource","data","generateId","slice","reverse","addDynamicLayer","prevProps","_this6","getSource","setData","center","setCenter","isActive","join","_this7","mapboxgl","container","mapContainer","MapboxGeocoder","language","placeholder","countries","addControl","cityPicker","marker","clearOnBlur","flyTo","result","flyToPos","speed","minZoom","document","querySelector","classList","clear","NavigationControl","showCompass","geolocate","GeolocateControl","positionOptions","enableHighAccuracy","trackUserLocation","longitude","latitude","initLayers","Popup","closeOnClick","closeButton","className","_this8","react_default","a","createElement","ref","el","Component","Spinner","city","fontSize","role","aria-label","space","size","direction","es_button","onClick","onClose","viewBox","cx","cy","r","fill","strokeWidth","strokeMiterlimit","CitySwitcherBackdrop","slugify","str","RegExp","toString","toLowerCase","replace","c","charAt","indexOf","typeSizes","undefined","boolean","number","string","item","object","keys","reduce","total","key","sizeOf","value","TopBar","Modal","info","title","content","href","target","rel","src","itdp","alt","ucb","onOk","add","focus","get","set","updatedAtStr","parts","state","lastUpdate","toLocaleString","height","logo","align","showCityPicker","CaretDownFilled","color","date","Date","seconds","Math","floor","interval","timeSince","popover","placement","maxWidth","icon","RedoOutlined","ghost","forceUpdate","arrowPointAtCenter","InfoCircleOutlined","marginLeft","downloadData","DownloadOutlined","MapStyleSwitcher","selected","options","img","normal","satellite","prevState","onMapShowSatelliteChanged","option","i","setState","LayersPanel","biggestLength","newVal","onLayersChange","lengthInKm","normalizer","hasLengths","round","width","onChange","opacity","calculateMiniatureLength","background","borderRadius","borderLeft","borderRight","margin","transition","fontWeight","servers","OSMController","constraints","areaId","f_inner","massageLayersData","Promise","resolve","reject","geoJson","$","getJSON","encodeURI","nominatimData","osm_id","getQuery","encodedQuery","requests","_loop","endpoint","elements","abort","osmtogeojson","flatProperties","isLastRemainingRequest","status","fail","statusText","notification","computeTypologies","feature","partsToMatch","propertyKey","calculateLayersLengths","firebaseConfig","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","Storage","firebase","initializeApp","db","firestore","collection","where","querySnapshot","doc","docs","d","log","table","compressed","pako","deflate","JSON","stringify","to","gzipCompress","jsonStr","part","now","slug","updatedAt","fullPrecisionFloats","saveStatsToFirestore","saveToFirestore","part1","ceil","part2","exists","dataBuffer","getDataFromDB","parse","toDate","withRouterAndRef","Wrapped","WithRouter","withRouter","_ref","forwardRef","otherProps","objectWithoutProperties","assign","WithRouterAndRef","React","displayName","App","updateData","onSpinnerClose","prev","getStateFromLocalStorage","urlParams","getParamsFromURL","z","parseFloat","loading","mapStyle","loadLayers","layersStates","storage","addEventListener","saveStateToLocalStorage","getLayers","savedState","localStorage","getItem","requestAnimationFrame","setItem","URLSearchParams","location","search","paramsObj","oldData","newData","nbrOldFeatures","nbrNewFeatures","arguments","_options$areaName","areaName","getData","isDataHealthy","Error","save","dataUpdatedAt","getDataFromOSM","load","newLayers","geoJsonWithTypes","fileName","blob","Blob","saveAs","downloadObjectAsJson","onRouteChanged","params","toFixed","history","push","newState","src_TopBar_0","src_CitySwitcherBackdrop_0","src_Map_0","src_MapStyleSwitcher_0","src_LayersPanel_0","src_Spinner_0","Boolean","hostname","match","ReactDOM","render","react_router_dom","src_App_0","app","ciclomapa","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.505ba9dc.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/itdp.c441e7e0.png\";","module.exports = __webpack_public_path__ + \"static/media/ucb.8a36a689.png\";","module.exports = __webpack_public_path__ + \"static/media/logo_green.d4480602.svg\";","module.exports = __webpack_public_path__ + \"static/media/normal.9a5dc9c9.png\";","module.exports = __webpack_public_path__ + \"static/media/satelite.a853a709.png\";","export const MAPBOX_ACCESS_TOKEN = 'pk.eyJ1IjoiY21kYWxiZW0iLCJhIjoiY2pnbXhjZnplMDJ6MjMzbnk0OGthZGE1ayJ9.n1flNO8ndRYKQcR9wNIT9w';\n\nexport const DEFAULT_BORDER_WIDTH = 3;\n\nexport const DEFAULT_AREA = 'Fortaleza, Ceará, Brazil';\nexport const DEFAULT_LNG = -38.5225359;\nexport const DEFAULT_LAT = -3.7719909;\nexport const DEFAULT_ZOOM = 10.9;\n\nconst ONE_DAY_MS = 1000 * 60 * 60 * 24;\nexport const OSM_DATA_MAX_AGE_MS = 7 * ONE_DAY_MS;\n\nexport const MIN_ZOOM_TO_LOAD_DATA = 10;\n\nexport const TOPBAR_HEIGHT = 64;\n\nexport const MOBILE_MAX_WIDTH = '430px';\nexport const DESKTOP_MIN_WIDTH = '430px';\nexport const IS_MOBILE = window.matchMedia && window.matchMedia(`(max-width: ${MOBILE_MAX_WIDTH})`).matches;","import React, { Component } from 'react';\n\nimport mapboxgl from 'mapbox-gl'\nimport 'mapbox-gl/dist/mapbox-gl.css';\n\nimport turfLength from '@turf/length';\n\nimport MapboxGeocoder from '@mapbox/mapbox-gl-geocoder'\nimport '@mapbox/mapbox-gl-geocoder/dist/mapbox-gl-geocoder.css'\n\nimport mbxGeocoding from '@mapbox/mapbox-sdk/services/geocoding';\n\nimport { MAPBOX_ACCESS_TOKEN, IS_MOBILE, DEFAULT_ZOOM } from './constants.js'\n\nimport './Map.css'\n\n\nconst geocodingClient = mbxGeocoding({ accessToken: MAPBOX_ACCESS_TOKEN });\n\n\nclass Map extends Component {\n    map;\n    popup;\n    searchBar;\n    hoverPopup;\n    selectedCycleway;\n    hoveredCycleway;\n\n    constructor(props) {\n        super(props);\n\n        this.onMapMoved = this.onMapMoved.bind(this);\n    }\n\n    showPopup(e) {\n        const coords = e.lngLat;\n        const props = e.features[0].properties;\n\n        const layer = this.props.layers.find(l =>\n            l.id === e.features[0].layer.id.split('--')[0]\n        );\n\n        let html = '';\n\n        html += `\n            <h2 style=\"margin-top: 1em; font-size: 22px;\">\n                ${props.name ? props.name : '<i style=\"color: gray;\">Sem nome</i>'}\n            </h2>`;\n\n        html += `\n            <div style=\"font-size: 14px\">\n                <div class=\"pill\" style=\"background-color: ${layer.style.lineColor}\">\n                    ${layer.name}\n                </div>\n            </div>`;\n\n        // html += `<h3>Tipo: ${layer.name}</h3>`;\n        // html += `<p>${layer.description}</p>`;\n\n        // const prettyProps = JSON.stringify(props, null, 2)\n        //     .replace(/(?:\\r\\n|\\r|\\n)/g, '<br/>')\n        //     .replace(/\"|,|\\{|\\}/g, '');\n        // html += prettyProps;\n\n        html += `\n            <div class=\"footer\">\n                Acha que este dado pode ser melhorado?\n                <br>\n                <a\n                    target=\"_BLANK\"\n                    rel=\"noopener\"\n                    href=\"https://www.openstreetmap.org/${props.id}\"\n                >\n                    Editar no OSM →\n                </a>\n            </div>\n    `;\n\n        this.popup.setLngLat(coords)\n            .setHTML(html)\n            .addTo(this.map);\n    }\n\n    showHoverPopup(e) {\n        const coords = e.lngLat;\n\n        const layer = this.props.layers.find(l =>\n            l.id === e.features[0].layer.id.split('--')[0]\n        );\n\n        this.hoverPopup.setLngLat(coords)\n            .setHTML(`<h3>${layer.name}<h3>`)\n            .addTo(this.map);\n    }\n\n    hidePopup() {\n        this.popup.remove();\n    }\n\n    // southern-most latitude, western-most longitude, northern-most latitude, eastern-most longitude\n    getCurrentBBox() {\n        const fallback = \"-23.036345361742164,-43.270405878917785,-22.915284125684607,-43.1111041211104\";\n\n        if (this.map) {\n            const sw = this.map.getBounds().getSouthWest();\n            const ne = this.map.getBounds().getNorthEast();\n            return `${sw.lat},${sw.lng},${ne.lat},${ne.lng}`;\n        } else {\n            return fallback;\n        }\n    }\n\n    reverseGeocode(lngLat) {\n        console.debug('lngLat', lngLat);\n\n        if (!lngLat || !lngLat[0] || !lngLat[1]) {\n            console.error('Something wrong with lngLat passed.');\n            return;\n        }\n\n        // Clear previous map panning limits\n        this.map.setMaxBounds();\n\n        geocodingClient\n            .reverseGeocode({\n                query: lngLat,\n                types: ['place'],\n                limit: 1\n            })\n            .send()\n            .then(response => {\n                const features = response.body.features;\n\n                console.debug('reverseGeocode', features);\n\n                if (features && features[0]) {\n                    const place = features[0];\n\n                    if (this.searchBar) {\n                        this.searchBar.setBbox(place.bbox);\n                    }\n\n                    // Disabled temporarily because it had a bug that it changed the map center\n                    // this.map.once('moveend', () => {\n                    //     this.map.setMaxBounds([\n                    //         [place.bbox[0]-0.15, place.bbox[1]-0.15], // Southwest coordinates\n                    //         [place.bbox[2]+0.15, place.bbox[3]+0.15]  // Northeast coordinates\n                    //     ]); \n                    // });\n                    \n                    this.props.onMapMoved({area: place.place_name});\n                }\n            })\n            .catch(err => {\n                console.error(err.message);\n            });\n    }\n\n    onMapMoved() {\n        const lat = this.map.getCenter().lat;\n        const lng = this.map.getCenter().lng;\n        const zoom = this.map.getZoom();\n\n        this.props.onMapMoved({\n            lat: lat,\n            lng: lng,\n            zoom: zoom,\n        });\n\n        // console.debug('onMapMoved');\n    }\n\n    getMapboxFilterForLayer(l) {\n        return [\n            \"any\",\n            ...l.filters.map(f =>\n                typeof f[0] === 'string' ?\n                    [\"==\", [\"get\", f[0]], f[1]]\n                    :\n                    [\"all\",\n                        ...f.map(f2 =>\n                            [\"==\", [\"get\", f2[0]], f2[1]]\n                        )\n                    ]\n            )\n        ];\n    }\n\n    addDynamicLayer(l) {\n        const filters = this.getMapboxFilterForLayer(l);\n\n        // Check if layer has a border color set. If that's the case the logic is a\n        //  little different and we'll need 2 layers, one for the line itself and \n        //  another for the line underneath which creates the illusion of a border.\n        if (l.style.borderColor) {\n            // Border\n            this.map.addLayer({\n                \"id\": l.id+'--border',\n                \"type\": \"line\",\n                \"source\": \"osm\",\n                \"name\": l.name,\n                \"description\": l.description,\n                \"layout\": {\n                    \"line-join\": \"round\",\n                    \"line-cap\": \"round\"\n                },\n                \"paint\": {\n                    \"line-color\": l.style.borderColor,\n                    \"line-width\": [\n                        \"interpolate\",\n                            [\"exponential\", 1.5],\n                            [\"zoom\"], \n                            10, 2,\n                            18, [ 'case',\n                                ['boolean', ['feature-state', 'hover'], false],\n                                l.style.lineWidth*6,\n                                l.style.lineWidth*3\n                            ]\n                    ],\n                    ...(l.style.borderStyle === 'dashed' && {'line-dasharray': [.2, 2.5]})\n                },\n                \"filter\": filters,\n            }, 'road-label-small');\n\n            // Line\n            this.map.addLayer({\n                \"id\": l.id,\n                \"type\": \"line\",\n                \"source\": \"osm\",\n                \"name\": l.name,\n                \"description\": l.description,\n                \"layout\": {\n                    \"line-join\": \"round\",\n                    \"line-cap\": \"round\"\n                },\n                \"paint\": {\n                    \"line-color\": l.style.lineColor,\n                    \"line-width\": [\n                        \"interpolate\",\n                            [\"exponential\", 1.5],\n                            [\"zoom\"],\n                            10, 2,\n                            18, [ 'case',\n                                ['boolean', ['feature-state', 'hover'], false],\n                                (l.style.lineWidth - l.style.borderWidth)*6,\n                                (l.style.lineWidth - l.style.borderWidth)*3\n                            ]\n                    ],\n                    ...(l.style.lineStyle === 'dashed' && {'line-dasharray': [.2, 2.5]})\n                },\n                \"filter\": filters,\n            }, 'road-label-small');\n        } else {\n            this.map.addLayer({\n                \"id\": l.id,\n                \"type\": \"line\",\n                \"source\": \"osm\",\n                \"name\": l.name,\n                \"description\": l.description,\n                \"layout\": {\n                    \"line-join\": \"round\",\n                    \"line-cap\": \"round\"\n                },\n                \"paint\": {\n                    \"line-color\": l.style.lineColor,\n                    \"line-width\": [\n                        \"interpolate\",\n                            [\"exponential\", 1.5],\n                            [\"zoom\"],\n                            10, 2,\n                            18, [ 'case',\n                                ['boolean', ['feature-state', 'hover'], false],\n                                l.style.lineWidth*6,\n                                l.style.lineWidth*3\n                            ]\n                    ],\n                    ...(l.style.lineStyle === 'dashed' && {'line-dasharray': [.2, 2.5]})\n                },\n                \"filter\": filters,\n            }, 'road-label-small');\n        }\n\n        \n        // Interactions\n\n        const interactiveId = l.style.borderColor ? \n            l.id + '--border'\n            : l.id;\n\n        this.map.on(\"mouseenter\", interactiveId, e => {\n            if (e.features.length > 0) {\n                // Cursor\n                this.map.getCanvas().style.cursor = 'pointer';\n\n                // Hover style\n                if (this.hoveredCycleway) {\n                    this.map.setFeatureState({ source: 'osm', id: this.hoveredCycleway }, { hover: false });\n                }\n                this.hoveredCycleway = e.features[0].id;\n                this.map.setFeatureState({ source: 'osm', id: this.hoveredCycleway }, { hover: true });\n\n                // this.showHoverPopup(e);\n            }\n        });\n\n        this.map.on(\"mouseleave\", interactiveId, e => {\n            // Hover style\n            if (this.hoveredCycleway && !this.selectedCycleway) {\n                this.map.setFeatureState({ source: 'osm', id: this.hoveredCycleway }, { hover: false });\n\n                // Cursor cursor\n                this.map.getCanvas().style.cursor = '';\n            }\n            this.hoveredCycleway = null;\n        });\n\n        this.map.on(\"click\", interactiveId, e => {\n            if (e.features.length > 0) {\n                if (this.selectedCycleway) {\n                    this.map.setFeatureState({ source: 'osm', id: this.selectedCycleway }, { hover: false });\n                }\n                this.selectedCycleway = e.features[0].id;\n                this.map.setFeatureState({ source: 'osm', id: this.selectedCycleway }, { hover: true });\n\n                this.showPopup(e);\n            }\n        });\n    }\n\n    calculateLayersLengths() {\n        let lengths = {};\n        this.props.layers.forEach(l => {\n            // Obs: querySourceFeatures only considers what is visible in the screen!\n            const features = this.map.querySourceFeatures('osm', { filter: this.getMapboxFilterForLayer(l) });\n\n            let length = 0;\n            features.forEach(f => {\n                length += turfLength(f);\n            })\n\n            lengths[l.id] = length;\n        });\n\n        this.props.updateLengths(lengths);\n    }\n\n    initLayers() {\n        console.debug('initLayers');\n\n        this.map.setLayoutProperty(\n            'satellite',\n            'visibility',\n            this.props.showSatellite ? 'visible' : 'none');\n\n        this.map.addSource(\"osm\", {\n            \"type\": \"geojson\",\n            \"data\": this.props.data || {\n                'type': 'FeatureCollection',\n                'features': []\n            },\n            \"generateId\": true\n        });\n\n        // In GeoJSON layers are from most important to least important, but we \n        //   want the most important ones to be on top.\n        // Slice is used here to don't destructively reverse the original array.\n        this.props.layers.slice().reverse().forEach(l => {\n            this.addDynamicLayer(l);\n        }); \n\n        // if (!IS_MOBILE) {\n        //     this.map.on('sourcedata', e => {\n        //         if (e.isSourceLoaded) {\n        //             this.calculateLayersLengths();\n        //         }\n        //     });\n        // }\n\n        // this.map.addSource('some id', {\n        //     type: 'geojson',\n        //     // data: 'http://overpass-api.de/api/interpreter?data=node[amenity=school](bbox);out;(way[amenity=school](bbox);node(w););out;'\n        //     // data: 'http://overpass-api.de/api/interpreter?data=node[name=%22Im Tannenbusch%22][highway=bus_stop];out+skel;'\n        //     data: 'https://firebasestorage.googleapis.com/v0/b/ciclomapa-app.appspot.com/o/ciclomapa-Nitero%CC%81i%2C%20Rio%20De%20Janeiro%2C%20Brazil.json?alt=media&token=79733a19-009d-46f1-af7b-e55bb3dd9bb5'\n        // });\n    }\n\n    componentDidUpdate(prevProps) {\n        if (!this.map || !this.map.getSource('osm')) {\n            return;\n        }\n\n        if (this.props.data !== prevProps.data) {\n            this.map.getSource('osm').setData(this.props.data);\n        }\n        \n        if (this.props.showSatellite !== prevProps.showSatellite) {\n            this.map.setLayoutProperty(\n                'satellite',\n                'visibility',\n                this.props.showSatellite ? 'visible' : 'none');\n        }\n        \n        // if (this.props.zoom !== prevProps.zoom) {\n        //     this.map.setZoom(this.props.zoom);\n        // }\n        \n        if (this.props.center !== prevProps.center) {\n            this.map.setCenter(this.props.center);\n        }\n        \n        // Compare only 'isActive' field of layers\n        if (this.props.layers.map(l => l.isActive).join() === prevProps.layers.map(l => l.isActive).join()) {\n            this.props.layers.forEach( l => {\n                this.map.setLayoutProperty(l.id, 'visibility', l.isActive ? 'visible' : 'none');\n                if (l.style.borderColor) {\n                    this.map.setLayoutProperty(l.id+'--border', 'visibility', l.isActive ? 'visible' : 'none');\n                }\n            })\n        }\n    }\n    \n    componentDidMount() {\n        mapboxgl.accessToken = MAPBOX_ACCESS_TOKEN;\n        \n        this.map = new mapboxgl.Map({\n            container: this.mapContainer,\n            style: this.props.style,\n            center: this.props.center,\n            zoom: this.props.zoom\n        });\n\n        // Native Mapbox map controls\n\n        if (!IS_MOBILE) {\n            this.searchBar = new MapboxGeocoder({\n                accessToken: mapboxgl.accessToken,\n                mapboxgl: mapboxgl,\n                language: 'pt-br',\n                placeholder: 'Buscar endereços, estabelecimentos, ...',\n                countries: 'br',\n                // collapsed: IS_MOBILE\n            });\n            this.map.addControl(this.searchBar, 'bottom-right');\n        }\n\n        const cityPicker = new MapboxGeocoder({\n            accessToken: mapboxgl.accessToken,\n            mapboxgl: mapboxgl,\n            language: 'pt-br',\n            placeholder: 'Buscar cidades brasileiras',\n            countries: 'br',\n            types: 'place',\n            marker: false,\n            clearOnBlur: true,\n            flyTo: false\n        });\n        cityPicker.on('result', result => {\n            console.debug('geocoder result', result);\n\n            let flyToPos;\n            if (result.place_name === 'Vitória, Espírito Santo, Brasil') {\n                flyToPos = [-40.3144,-20.2944];\n            } else {\n                flyToPos = result.result.center;\n            }\n            this.map.flyTo({\n                center: flyToPos,\n                zoom: DEFAULT_ZOOM,\n                speed: 2,\n                minZoom: 6\n            });\n\n            this.reverseGeocode(result.result.center);\n            \n            // Hide UI\n            // @todo refactor this to use React state\n            document.querySelector('body').classList.remove('show-city-picker');\n            cityPicker.clear();\n        });\n        this.map.addControl(cityPicker, 'top-left');\n\n        this.map.addControl(\n            new mapboxgl.NavigationControl({\n                showCompass: false\n            }),\n            'bottom-right'\n        );\n        const geolocate = new mapboxgl.GeolocateControl({\n            positionOptions: {\n                enableHighAccuracy: true\n            },\n            trackUserLocation: false\n        });\n        geolocate.on('geolocate', result => {\n            console.debug('geolocate', result); \n            this.reverseGeocode([result.coords.longitude, result.coords.latitude]);\n        });\n        this.map.addControl(geolocate, 'bottom-right');\n        \n        \n        // map.addControl(new mapboxgl.FullscreenControl({ container: document.querySelector('body') }));\n\n\n        // Listeners\n\n        this.map.on('load', () => {\n            this.initLayers();\n            this.onMapMoved();\n\n            this.map.on('moveend', this.onMapMoved);\n\n            // Further chages on styles reinitilizes layers\n            // this.map.on('style.load', () => {\n            //     this.initLayers();\n            //     this.onMapMoved();\n            // });\n        });\n\n\n        this.popup = new mapboxgl.Popup({\n            closeOnClick: false\n        });\n        this.popup.on('close', e => {\n            if (this.selectedCycleway) {\n                this.map.setFeatureState({ source: 'osm', id: this.selectedCycleway }, { hover: false });\n            }\n            this.selectedCycleway = null;\n        });\n\n        this.hoverPopup = new mapboxgl.Popup({\n            closeButton: false,\n            className: 'hover-popup'\n        });\n        \n        // Initialize map data center\n        this.reverseGeocode(this.props.center);\n    }\n\n    render() {\n        return (\n            // Thanks https://blog.mapbox.com/mapbox-gl-js-react-764da6cc074a\n            <div ref={el => this.mapContainer = el}></div>\n        )\n    }\n}\n\nexport default Map;","import React, { Component } from 'react';\nimport { Button, Space } from 'antd';\n\nimport './Spinner.css'\n\nclass Spinner extends Component {\n    render() {\n        const parts = this.props.area.split(',');\n        const city = parts[0];\n            // state = parts[1],\n            // country = parts[2];\n\n        return (\n            <div id=\"spinner\" className=\"loader-container\">\n                <div className=\"loader\">\n                    {\n                        this.props.error ?\n                            <div>\n                                <div style={{fontSize: '42px'}}>\n                                    <span role=\"img\" aria-label=\"Emoji triste\">😓</span>\n                                </div>\n\n                                <div className=\"content\">\n                                    <h1>\n                                        Ops!\n                                    </h1>\n\n                                    <Space size=\"large\" direction=\"vertical\">\n                                        <h3>\n                                            O OSM está mal humorado neste momento e não conseguimos acessar os dados. Tente novamente mais tarde.\n                                        </h3>\n\n                                        <Button \n                                            type=\"primary\"\n                                            onClick={this.props.onClose}>\n                                            OK\n                                        </Button>\n                                    </Space>\n                                </div>\n                            </div>\n                            :\n                            <div>\n                                <svg className=\"spinnersvg\" viewBox='25 25 50 50'>\n                                    <circle className=\"path\" cx='50' cy='50' r='20' fill='none' strokeWidth='6' strokeMiterlimit='10'\n                                    />\n                                </svg>\n\n                                <div className=\"content\">\n                                    <h1>\n                                        Carregando mapa cicloviário de <b>{city}</b>.\n                                    </h1>\n\n                                    <h3>\n                                        Estamos acessando diretamente os dados mais atualizados do OpenStreetMaps. Isso pode levar algumas dezenas segundos dependendo do tamanho da cidade.\n                                    </h3>\n                                </div>\n                            </div>\n\n                    }\n                </div>\n\n            </div>\n        )\n    }\n}\n\nexport default Spinner;","import React, { Component } from 'react';\n\nimport './CitySwitcherBackdrop.css'\n\nimport { Button } from 'antd';\n\n\nclass CitySwitcherBackdrop extends Component {\n    onClose() {\n        let body = document.querySelector('body');\n        body.classList.remove('show-city-picker')\n    }\n\n    render() {\n        return (\n            <div id=\"backdrop\" onClick={this.onClose}>\n                <Button\n                    id=\"closeBtn\"\n                    // ghost\n                    // shape=\"circle\"\n                    // icon=\"close\"\n                    type=\"link\"\n                    size=\"large\"\n                    onClick={this.onClose}\n                >\n                    Cancelar\n                </Button>\n            </div>\n        )\n    }\n}\n\nexport default CitySwitcherBackdrop;","import { saveAs } from 'file-saver';\n\n\nexport function doesAContainsB(a, b) {\n    if (a && b) {\n        return a.getNorth() >= b.getNorth()\n            && a.getSouth() <= b.getSouth()\n            && a.getEast() >= b.getEast()\n            && a.getWest() <= b.getWest();\n    } else {\n        return null;\n    }\n}\n\n// Thanks https://stackoverflow.com/questions/19721439/download-json-object-as-a-file-from-browser\nexport function downloadObjectAsJson(data, fileName) {\n    const blob = new Blob([JSON.stringify(data)], {\n        type: 'application/json',\n        name: fileName\n    }); \n    saveAs(blob, fileName);\n}\n\nexport function createPolygonFromBBox(bbox) {\n    return {\n        'type': 'Feature',\n        'geometry': {\n            'type': 'Polygon',\n            'coordinates': [\n                [\n                    bbox.getNorthWest().toArray(),\n                    bbox.getNorthEast().toArray(),\n                    bbox.getSouthEast().toArray(),\n                    bbox.getSouthWest().toArray(),\n                    bbox.getNorthWest().toArray()\n                ]\n            ]\n        }\n    };\n}\n\n// Thanks https://medium.com/@mhagemann/the-ultimate-way-to-slugify-a-url-string-in-javascript-b8e4a0d849e1\nexport function slugify(str) {\n  const a = 'àáäâãåăæçèéëêǵḧìíïîḿńǹñòóöôœøṕŕßśșțùúüûǘẃẍÿź·/_,:;'\n  const b = 'aaaaaaaaceeeeghiiiimnnnooooooprssstuuuuuwxyz------'\n  const p = new RegExp(a.split('').join('|'), 'g')\n  return str.toString().toLowerCase()\n    .replace(/\\s+/g, '-') // Replace spaces with -\n    .replace(p, c => b.charAt(a.indexOf(c))) // Replace special characters\n    .replace(/&/g, '-and-') // Replace & with ‘and’\n    .replace(/[^\\w-]+/g, '') // Remove all non-word characters\n    .replace(/--+/g, '-') // Replace multiple - with single -\n    .replace(/^-+/, '') // Trim - from start of text\n    .replace(/-+$/, '') // Trim - from end of text\n}\n\nconst typeSizes = {\n    \"undefined\": () => 0,\n    \"boolean\": () => 4,\n    \"number\": () => 8,\n    \"string\": item => 2 * item.length,\n    \"object\": item => !item ? 0 : Object\n        .keys(item)\n        .reduce((total, key) => sizeOf(key) + sizeOf(item[key]) + total, 0)\n};\n\nexport const sizeOf = value => typeSizes[typeof value](value);\n\n// Thanks https://stackoverflow.com/questions/3177836/how-to-format-time-since-xxx-e-g-4-minutes-ago-similar-to-stack-exchange-site\nexport function timeSince(date) {\n    date = new Date(date);\n\n    var seconds = Math.floor((new Date() - date) / 1000);\n\n    var interval = Math.floor(seconds / 31536000);\n\n    if (interval > 1) {\n        return interval + \" anos\";\n    }\n    interval = Math.floor(seconds / 2592000);\n    if (interval > 1) {\n        return interval + \" meses\";\n    }\n    interval = Math.floor(seconds / 86400);\n    if (interval > 1) {\n        return interval + \" dias\";\n    }\n    interval = Math.floor(seconds / 3600);\n    if (interval > 1) {\n        return interval + \" horas\";\n    }\n    interval = Math.floor(seconds / 60);\n    if (interval > 1) {\n        return interval + \" minutos\";\n    }\n    // return Math.floor(seconds) + \" segundos\";\n    return \" poucos segundos\";\n}","import React, { Component } from 'react';\n\nimport { TOPBAR_HEIGHT, IS_MOBILE } from './constants'\n\nimport { DownloadOutlined, InfoCircleOutlined, RedoOutlined, CaretDownFilled} from '@ant-design/icons';\n\nimport { Space, Modal, Button, Popover } from 'antd';\n\nimport { timeSince } from './utils.js'\n\nimport { get, set } from 'idb-keyval';\n\nimport itdp from './img/itdp.png';\nimport ucb from './img/ucb.png';\nimport logo from './img/logo_green.svg';\n\nimport './TopBar.css'\n\nclass TopBar extends Component {\n    info() {\n        Modal.info({\n            title: 'Sobre',\n            className: 'about-modal',\n            content: (\n                <div>\n                    <p>\n                        O <b>CicloMapa</b> é uma ferramenta que busca ampliar a visibilidade das infraestruturas cicloviárias (ou a falta delas), disponibilizando dados que auxiliem a incidência em políticas públicas para a ciclomobilidade.\n                    </p>\n\n                    <p>\n                        Utilizando o <a href=\"https://www.openstreetmap.org/\" title=\"OpenStreetMap\" target=\"_blank\" rel=\"noopener noreferrer\">OpenStreetMap</a>, uma plataforma colaborativa de mapeamento de dados geo-espaciais abertos, também procura engajar a comunidade em sua atualização.\n                    </p>\n\n                    <p>\n                        Para saber mais sobre a iniciativa e como contribuir com o mapeamento de sua cidade, acesse a <a href=\"https://www.uniaodeciclistas.org.br/atuacao/ciclomapa/\" title=\"CicloMapa | UCB - União de Ciclistas do Brasil\" target=\"_blank\" rel=\"noopener noreferrer\">página do projeto no site da UCB</a>.\n                    </p>\n\n                    <p>\n                        Este é um projeto de código aberto (<i>Open Source</i>) e pode ser encontrado no <a href=\"https://github.com/cmdalbem/ciclomapa/\" title=\"GitHub\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub</a>.\n                    </p>\n\n                    <div>\n                        Realização:\n\n                        <div className=\"logos\">\n                            <a href=\"https://itdpbrasil.org/\" target=\"_BLANK\" rel=\"noopener noreferrer\">\n                                <img src={itdp} alt=\"Logo do ITDP\"></img>\n                            </a>\n                            <a href=\"https://www.uniaodeciclistas.org.br/\" target=\"_BLANK\" rel=\"noopener noreferrer\">\n                                <img src={ucb} alt=\"Logo da UCB\"></img>\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            ),\n            onOk() { },\n        });\n    }\n\n    showCityPicker() {\n        let body = document.querySelector('body');\n        body.classList.add('show-city-picker');\n        body.querySelector('.mapboxgl-ctrl-top-left .mapboxgl-ctrl-geocoder input').focus();\n    }\n\n    componentDidMount() {\n        get('hasSeenWelcomeMsg')\n                .then(data => {\n                    if (!data) {\n                        this.info();\n                        set('hasSeenWelcomeMsg', true);\n                    }\n                });\n    }\n\n    render() {\n        const parts = this.props.title.split(',');\n        const city = parts[0], \n            state = parts[1];\n            // country = parts[2];\n        let updatedAtStr;\n\n        if (this.props.lastUpdate) {\n            updatedAtStr = this.props.lastUpdate.toLocaleString('pt-BR');\n        }\n        \n        return (\n            <div className=\"topbar\" style={{height: TOPBAR_HEIGHT}}>\n                <div id=\"logo\">\n                    <img src={logo} alt=\"CicloMapa\"></img>\n                </div>\n\n                <div className=\"city-picker\">\n                    <Space size={4} direction=\"vertical\" align=\"center\">\n                        <Button\n                            size={IS_MOBILE ? 'default' : 'large'}\n                            onClick={this.showCityPicker}\n                        >\n                            <h3 className=\"areaname\">\n                                <span className=\"state\">\n                                    {state}\n                                </span>\n                                <span className=\"city\">\n                                    {city}\n                                </span>\n\n                                <CaretDownFilled style={{ fontSize: '16px', color: '#4ba96e' }} />\n                            </h3>\n                        </Button>\n\n                        {\n                            this.props.lastUpdate &&\n                            <span className=\"data-tooltip\">\n                                Atualizado há <b>{timeSince(this.props.lastUpdate)}</b>.\n                                <Popover\n                                    placement=\"bottom\"\n                                    content={(\n                                        <div style={{ maxWidth: 250 }}>\n                                            <Space size=\"small\" direction=\"vertical\" >\n                                                <div>\n                                                    O mapa que você está vendo é uma cópia dos dados obtidos do OpenStreetMaps em <b>{updatedAtStr}</b>.\n                                                </div> \n\n                                                <Button\n                                                    size=\"small\"\n                                                    icon={<RedoOutlined />}\n                                                    ghost\n                                                    onClick={this.props.forceUpdate}\n                                                >\n                                                    Atualizar\n                                                </Button>\n                                            </Space>\n                                        </div>\n                                    )}\n                                    arrowPointAtCenter={true}\n                                >\n                                    <InfoCircleOutlined style={{ fontSize: '12px', marginLeft: '4px' }} />\n                                </Popover>\n                            </span>\n\n                        }\n                    </Space>\n                </div>\n                \n                <div className=\"nav-links\">\n                    <Button\n                        size=\"large\"\n                        type=\"link\"\n                        onClick={this.info}\n                    >\n                        Sobre\n                    </Button>\n\n                    <Button\n                        ghost\n                        onClick={this.props.downloadData}\n                    >\n                        <DownloadOutlined /> Dados\n                    </Button>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default TopBar;","import React, { Component } from 'react';\n\n// import light from './img/light.png';\nimport normal from './img/normal.png';\nimport satellite from './img/satelite.png';\n\nimport './MapStyleSwitcher.css'\n\nclass MapStyleSwitcher extends Component {\n    state = { selected: this.props.showSatellite ? 1 : 0 };\n\n    options = [\n        {\n            name: 'dark',\n            img: normal,\n            // url: 'mapbox://styles/cmdalbem/ck14cy14g1vb81cp8hprnh4nx'\n        },\n        // {\n        //     img: light,\n        //     url: 'mapbox://styles/cmdalbem/cjxseldep7c0a1doc7ezn6aeb'\n        // },\n        {\n            name: 'satellite',\n            img: satellite\n        },\n    ];\n\n    componentDidUpdate(prevProps, prevState) {\n        if (this.state !== prevState) {\n            const selected = this.options[this.state.selected]\n            // this.props.onMapStyleChange(selected.url)\n\n            this.props.onMapShowSatelliteChanged(selected.name === 'satellite');\n        }\n    }\n\n    render() {\n        return (\n            <div className=\"switcher-bar\">\n                {\n                    this.options.map( (option, i) =>\n                        <div\n                            onClick={() => this.setState({ selected: i })}\n                            className={this.state.selected === i ? 'selected' : ''}\n                            key={option.img}\n                        >\n                            <img src={option.img} alt=\"\"/>\n                        </div>\n                    )\n                }\n            </div>\n        )\n    }\n}\n\nexport default MapStyleSwitcher;","import React, { Component } from 'react';\n\nimport { Switch, Popover } from 'antd';\n\nimport { slugify } from './utils.js'\n\nimport './LayersPanel.css';\n\n\nconst MAX_MINIATURE_LENGTH = 250;\n\n\nclass LayersPanel extends Component {\n    biggestLength = 0;\n\n    onChange(id, newVal) {\n        this.props.onLayersChange(id, newVal)\n    }\n\n    calculateMiniatureLength(lengthInKm) {\n        let normalizer = 1;\n        if (this.biggestLength > MAX_MINIATURE_LENGTH) {\n            normalizer = MAX_MINIATURE_LENGTH / this.biggestLength\n        }\n\n        if (lengthInKm > 0) {\n            return 24 + lengthInKm * normalizer;\n        } else {\n            return 'auto';\n        }\n    }\n\n    render() {\n        let lengths = {};\n        let hasLengths = false;\n        if (this.props.lengths && Object.keys(this.props.lengths).length > 0) {\n            this.props.layers.forEach(l => {\n                hasLengths = true;\n                lengths[l.id] = Math.round(this.props.lengths[l.id]);\n\n                if (lengths[l.id] > this.biggestLength) {\n                    this.biggestLength = lengths[l.id];\n                }\n            });\n        }\n\n        return (\n            <div className=\"layers-panel\">\n                {\n                    this.props.layers &&\n                    this.props.layers.map(l =>\n                        <Popover\n                            placement=\"left\"\n                            content={(\n                                <div style={{ maxWidth: '250px' }}>\n                                    <p> \n                                        <img style={{ width: '100%' }} src={'/' + slugify(l.name) + '.png'} alt=\"\"></img>\n                                    </p>\n                                    <div>\n                                        {l.description}\n                                    </div>\n                                </div>\n                            )}\n                            arrowPointAtCenter={true}\n                            key={l.name}\n                        >\n                            <div\n                                className=\"layer-row\"\n                                onClick={this.onChange.bind(this, l.id, !l.isActive)}\n                                style={{ opacity: l.isActive ? 1 : .3 }}\n                            >\n                                <div>\n                                    <span className=\"layer-name\">\n                                        {l.name}\n                                    </span>\n                                </div>\n\n                                <div>\n                                    <span\n                                        className={\"layer-miniature \" + (!hasLengths && 'loading')}\n                                        style={{\n                                            height: l.style.borderStyle === 'solid' ? '6px' : '4px',\n                                            width: this.calculateMiniatureLength(lengths[l.id]),\n                                            background: l.style.lineStyle === 'solid' ?\n                                                l.style.lineColor\n                                                : `repeating-linear-gradient(90deg, ${l.style.lineColor}, ${l.style.lineColor} 3px, transparent 3px, transparent 6px)`,\n                                            borderColor: l.style.borderColor,\n                                            borderStyle: l.style.borderStyle,\n                                            borderRadius: '2px',\n                                            borderWidth: l.style.borderWidth ? l.style.borderWidth/2 : '0',\n                                            borderLeft: 'none',\n                                            borderRight: 'none',\n                                            margin: '6px 4px 6px 0',\n                                            transition: 'width 1s ease-in-out'\n                                    }}\n                                    ></span>\n\n                                    {\n                                        hasLengths &&\n                                            <span\n                                                className=\"layer-length\"\n                                                style={{\n                                                    fontWeight: 300,\n                                                    color: l.style.lineColor\n                                                }}\n                                            >\n                                                {lengths[l.id]}km\n                                            </span>\n                                    }\n                                </div>\n\n                                {/* <Switch size=\"small\" checked={l.isActive} /> */}\n                            </div>\n                        </Popover>\n                    )\n                }\n            </div>\n        )\n    }\n}\n\nexport default LayersPanel;","/* eslint-disable no-loop-func */\nimport osmtogeojson from 'osmtogeojson'\n\nimport $ from 'jquery'\n\nimport { notification } from 'antd';\n\nimport { DEFAULT_BORDER_WIDTH } from './constants.js'\nimport { slugify } from './utils.js'\n\nimport * as layers from './layers.json';\n\nconst servers = [\n    'https://overpass.kumi.systems/api/interpreter',\n    'https://overpass-api.de/api/interpreter',\n    'http://overpass.openstreetmap.fr/api/interpreter',\n    'http://overpass.osm.ch/api/interpreter',\n    'https://overpass.nchc.org.tw'\n];\n\nclass OSMController {\n    static getQuery(constraints) {\n        const bbox = constraints.bbox;\n        // const area = constraints.area.split(',')[0];\n        const areaId = constraints.areaId;\n\n        const body = layers.default.map(l =>\n            l.filters.map(f =>\n                'way'\n                + (typeof f[0] === 'string' ?\n                    `[\"${f[0]}\"=\"${f[1]}\"]`\n                    :\n                    f.map(f_inner =>\n                        `[\"${f_inner[0]}\"=\"${f_inner[1]}\"]`\n                    ).join(\"\"))\n                 + (bbox ? \n                    `(${bbox});\\n`\n                    :\n                    `(area.a);\\n`)\n            ).join(\"\")\n        ).join(\"\");\n\n        return `\n            [out:json][timeout:500];\n            ${!bbox && `area(${areaId})->.a;`}\n            (\n                ${body}\n            );\n            out body geom;\n        `;\n    }\n\n    static massageLayersData() {\n        layers.default.forEach(l => {\n            // Omitted values\n            l.style.lineStyle = l.style.lineStyle || 'solid';\n            l.isActive = l.isActive !== undefined ? l.isActive : true;\n\n            if (l.style.borderColor) {\n                l.style.borderStyle = l.style.borderStyle || 'solid';\n                l.style.borderWidth = l.style.borderWidth || DEFAULT_BORDER_WIDTH;\n            }\n            \n            // Generate an ID based on name\n            l.id = slugify(l.name);\n        });\n\n        return layers.default;\n    }\n\n    static getLayers() {\n        return this.massageLayersData();\n    }\n\n    static getData(constraints) {\n        return new Promise((resolve, reject) => {\n            let geoJson;\n\n            $.getJSON(\n                `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURI(constraints.area)}`,\n                nominatimData => {\n                    console.debug('nominatimData', nominatimData);\n\n                    // Source: https://wiki.openstreetmap.org/wiki/Overpass_API/Overpass_QL#By_area_.28area.29\n                    let areaId\n                    if (constraints.area === 'Vitória, Espirito Santo, Brazil') {\n                        areaId = 3601825817;\n                    } else if (constraints.area === 'Brasília, Distrito Federal, Brazil') {\n                        areaId = 3602662005;\n                    } else {\n                        areaId = 3600000000 + nominatimData[0].osm_id;\n                    }\n\n                    const query = OSMController.getQuery({ areaId: areaId});\n                    console.debug('generated query: ', query);\n\n                    const encodedQuery = encodeURI(query);\n\n                    let requests = [];\n                    for (let i = 0; i < servers.length; i++) {\n                        const endpoint = servers[i] + '?data=' + encodedQuery;\n                        \n                        console.debug(i + ' OSM server: ' + servers[i]);\n\n                        requests[i] = $.getJSON(\n                            endpoint,\n                            data => {\n                                if (data.elements.length > 0) {\n                                    console.debug('SUCCESS! @ ' + i);\n                                    for (let r = 0; r < requests.length; r++) {\n                                        if (r !== i) {\n                                            console.debug('Aborting ' + r);\n                                            requests[r].abort();\n                                        }\n                                    }\n    \n                                    console.debug('osm data: ', data);\n                                    geoJson = osmtogeojson(data, { flatProperties: true });\n                                    console.debug('converted to geoJSON: ', geoJson);\n                                    \n                                    resolve({\n                                        geoJson: geoJson\n                                    });\n                                } else {\n                                    console.debug(`Server ${i} returned an empty result.`);\n\n                                    // Check if I'm the last one\n                                    let isLastRemainingRequest = true;\n                                    for (let r = 0; r < requests.length; r++) {\n                                        if (r !== i) {\n                                            if (requests[r].status === undefined) {\n                                                isLastRemainingRequest = false;\n                                            }\n                                        }\n                                    }\n                                    if (isLastRemainingRequest) {\n                                        console.debug('I was the last one, so probably the result is empty.');\n                                        resolve({ geoJson: null });\n                                    }\n                                }\n                            }).fail(e => {\n                                if (e.statusText !== 'abort') {\n                                    console.error(`Servidor ${i} deu erro:`, e);\n                                }\n                            });\n                    }\n                }).fail(e => {\n                    console.error(\"Deu erro! Saca só:\", e);\n                    notification['error']({\n                        message: 'Erro',\n                        description:\n                            'Ops, erro na API do Nominatim. Abra o console para ver mais detalhes.',\n                    });\n\n                    reject();\n                });\n        });\n    }\n}\n\nexport default OSMController;","import pako from 'pako';\n// import { gzip } from 'zlib';\n\nimport turfLength from '@turf/length';\n\n\nexport function gzipDecompress(data) {\n    return JSON.parse(pako.inflate(data), { to: 'string' });\n}\n\nexport function gzipCompress(data) {\n    const compressed = pako.deflate(JSON.stringify(data), { to: 'string' });\n\n    // Test if compression went OK\n    // const decompressed = JSON.parse(pako.inflate(compressed), { to: 'string' });\n    // console.log(decompressed);\n\n    return compressed;\n}\n\nexport function cleanUpOSMTags(data) {\n    data.features.forEach(feature => {\n        Object.keys(feature.properties).forEach(propertyKey => {\n            if (propertyKey !== 'id' &&\n                propertyKey !== 'name' &&\n                propertyKey !== 'type')\n                delete feature.properties[propertyKey];\n        });\n    });\n}\n\nexport function computeTypologies(data, layers) {\n    const DEBUG = false;\n\n    if (!data || !data.features || data.features.length === 0) {\n        return data;\n    }\n\n    data.features.forEach(feature => {\n        if (DEBUG) {\n            console.debug(`${feature.properties.id} (${feature.properties.name})`);\n        }\n\n        if (!feature.properties.type) {\n            // Reverse layers orders so the most important ones override less important ones.\n            //   Slice is used here to don't destructively reverse the original array.\n            layers.slice().reverse().forEach(layer => {\n                let match = false;\n                layer.filters.forEach(filter => {\n                    let partsToMatch;\n                    if (typeof filter[0] === 'object') {\n                        partsToMatch = [false, false];\n                    } else {\n                        partsToMatch = [false];\n                    }\n\n                    Object.keys(feature.properties).forEach(propertyKey => {\n                        if (typeof filter[0] === 'object') {\n                            if ((propertyKey === filter[0][0] &&\n                                feature.properties[propertyKey] === filter[0][1])) {\n                                partsToMatch[0] = true;\n                            }\n\n                            if ((propertyKey === filter[1][0] &&\n                                feature.properties[propertyKey] === filter[1][1])) {\n                                partsToMatch[1] = true;\n                            }\n                        } else {\n                            if ((propertyKey === filter[0] &&\n                                feature.properties[propertyKey] === filter[1])) {\n                                partsToMatch[0] = true;\n                            }\n                        }\n                    });\n\n                    if ((typeof filter[0] === 'object' && partsToMatch[0] && partsToMatch[1])\n                        || partsToMatch[0]) {\n                        match = true;\n                        \n                        // \"Proibido\" layer should have priority over the rest\n                        if (!feature.properties.type || feature.properties.type !== 'Proibido') {\n                            feature.properties.type = layer.name;\n                        }\n                        // console.debug(`.  .  → ${feature.properties.name} (${feature.properties.id}) = ${layer.name}`);\n                    }\n\n                    // console.debug(`.  .  ${filter} ${match ? '✓' : ''}`);\n                });\n\n                if (DEBUG && match) {\n                    console.debug(`.  ${layer.name}`);\n                }\n            });\n        }\n    });\n\n    return data;\n}\n\nexport function calculateLayersLengths(geoJson, layers) {\n    let lengths = {};\n    \n    layers.forEach(l => {\n        const features = geoJson && geoJson.features ? \n            geoJson.features.filter(i => i.properties.type === l.name)\n            :\n            [];\n        \n        let length = 0;\n        features.forEach(f => {\n            length += turfLength(f);\n        })\n\n        lengths[l.id] = length;\n    });\n\n    return lengths;\n}","import { get, set } from 'idb-keyval';\n\nimport firebase from 'firebase';\n\nimport { slugify, sizeOf } from './utils.js'\nimport { gzipCompress } from './geojsonUtils.js'\nimport { stringify, parse } from 'zipson';\n\n\nconst DISABLE_LOCAL_STORAGE = true;\n\nconst firebaseConfig = {\n    apiKey: \"AIzaSyDUbMY3UuyJ9vVVBblhUR9L1B3TV6a3eRU\",\n    authDomain: \"ciclomapa-app.firebaseapp.com\",\n    databaseURL: \"https://ciclomapa-app.firebaseio.com\",\n    projectId: \"ciclomapa-app\",\n    storageBucket: \"ciclomapa-app.appspot.com\",\n    messagingSenderId: \"377722964538\",\n    appId: \"1:377722964538:web:bc0fada0b3db0587514303\"\n};\n\nclass Storage {\n    db;\n    dataBuffer;\n    \n    constructor() {\n        firebase.initializeApp({\n            apiKey: firebaseConfig.apiKey,\n            authDomain: firebaseConfig.authDomain,\n            projectId: firebaseConfig.projectId\n        });\n\n        this.db = firebase.firestore();\n    }\n\n    getAllCitiesDocs() {\n        return new Promise(resolve => {\n            this.db.collection(\"cities\")\n                .where(\"part\", \"==\", \"\")    \n                .get()\n                .then((querySnapshot) => {\n                    console.debug('[Firestore] Documents found:');\n                    querySnapshot.forEach((doc) => {\n                        console.debug('• ' + doc.id, ' => ', doc.data());\n                    });\n        \n                    resolve(querySnapshot);\n                });\n        });\n    }\n\n    getAllCitiesStats() {\n        return new Promise(resolve => {\n            this.db.collection(\"stats\")\n            .where(\"lengths.ciclovia\", \">=\", 0)    \n            .get()\n                .then((querySnapshot) => {\n                    console.debug('[Firestore] Documents found:');\n\n                    let docs = [];\n                    querySnapshot.forEach(doc => {\n                        let d = doc.data().lengths;\n                        \n                        d.total = d['ciclovia'];\n                        d.total += d['ciclorrota'];\n                        d.total += d['ciclofaixa'];\n                        d.total += d['calcada-compartilhada'];\n                        \n                        docs[doc.id] = d;\n                    });\n                    console.log(docs);\n                    console.table(docs);\n        \n                    resolve(querySnapshot);\n            });\n        });\n    }\n\n    compressJson(data) {\n        console.debug('Before: ', sizeOf(data));\n\n        // Minimize size by cleaning clearing OSM tags\n        // @todo DOESNT WORK because Mapbox needs the OSM tags to render the layers\n        // cleanUpOSMTags(data);\n        \n        // Compress with gzip\n        const compressed = gzipCompress(data);\n\n        console.debug('After: ', sizeOf(compressed));\n\n        return compressed;\n    }\n\n    saveToFirestore(name, jsonStr, lengths, part) {\n        const now = new Date();\n        let slug = slugify(name);\n\n        if (part === 2) {\n            slug += part;\n        }\n\n        return this.db.collection('cities').doc(slug).set({\n            name: name,\n            geoJson: jsonStr,\n            updatedAt: now,\n            lengths: lengths,\n            part: part || ''\n        });\n    }\n\n    saveStatsToFirestore(name, lengths) {\n        let slug = slugify(name);\n\n        return this.db.collection('stats').doc(slug).set({\n            lengths: lengths\n        });\n    }\n\n    save(name, geoJson, lengths) {\n        return new Promise((resolve, reject) => {\n            const now = new Date();\n\n            // Save to Local Storage\n            set(name, {\n                geoJson: geoJson,\n                updatedAt: now\n            });\n\n            // Save to Firestore\n            try {\n                const jsonStr = stringify(geoJson, { fullPrecisionFloats: true }); \n\n                // Useful for checking in the console the size differences\n                // console.debug('regular stringfy:', JSON.stringify(geoJson));\n                // console.debug('zipson stringfy:', jsonStr);\n\n                console.debug(`[Firebase] Saving document ${name}...`, geoJson);\n\n                this.saveStatsToFirestore(name, lengths)\n\n                // geoJson = this.compressJson(geoJson);\n                this.saveToFirestore(name, jsonStr, lengths)\n                    .then(() => {\n                        console.debug(`[Firebase] Document ${name} written successfully.`);\n                        resolve();\n                    }).catch(error => {\n                        console.debug('[Firestore] Failed saving full data, splitting in 2...')\n\n                        const part1 = jsonStr.slice(0, Math.ceil(jsonStr.length/2));\n                        const part2 = jsonStr.slice(Math.ceil(jsonStr.length/2));\n\n                        this.saveToFirestore(name, part1, lengths, 1) \n                        .then(() => {\n                            console.debug(`[Firebase] Document ${name}1 written successfully.`);\n                        }).catch(error => {\n                            console.error(\"[Firebase] Error adding document: \", error);\n                            reject();\n                        });        \n    \n                        this.saveToFirestore(name, part2, lengths, 2)\n                        .then(() => {\n                            console.debug(`[Firebase] Document ${name}2 written successfully.`);\n                            resolve();\n                        }).catch(error => {\n                            console.error(\"[Firebase] Error adding document: \", error);\n                            reject();\n                        });\n                    });\n            } catch (e) {\n                console.error(e);\n                reject();\n            }\n        });\n    }\n\n    getDataFromDB(slug, resolve, reject) {\n        this.db.collection(\"cities\").doc(slug).get().then(doc => {\n            if (doc.exists) {\n                let data = doc.data();\n\n                console.debug(\"[Firebase] Document data:\", data);\n\n                // Decompress gzip\n                // data.geoJson = gzipDecompress(data.geoJson)\n\n                // Split files case\n                if (data.part === 1) {\n                    this.dataBuffer = data.geoJson; \n                    return this.getDataFromDB(slug + '2', resolve, reject);\n                } else if (data.part === 2) {\n                    data.geoJson = this.dataBuffer + data.geoJson;\n                }\n \n                try {\n                    data.geoJson = parse(data.geoJson);\n                } catch(e) {\n                    // For retrocompatibility\n                    data.geoJson = JSON.parse(data.geoJson);\n                }\n                data.updatedAt = data.updatedAt.toDate();\n\n                resolve(data);\n            } else {\n                console.debug(\"[Firebase] No document for: \", slug);\n                resolve();\n            }\n        }).catch(error => {\n            console.error(`[Firebase] Error getting document: ${slug}`, error);\n            reject();\n        });\n    }\n\n    load(name) {\n        const slug = slugify(name);\n\n        return new Promise((resolve, reject) => {\n            if (!DISABLE_LOCAL_STORAGE) {\n                get(name).then( local => {\n                    if (local) {\n                        resolve(local);\n                    } else {\n                        this.getDataFromDB(slug, resolve, reject);\n                    }\n                })\n            } else {\n                this.getDataFromDB(slug, resolve, reject);\n            }\n        });\n    }\n}\n\nexport default Storage;","import React, { Component } from 'react';\nimport { withRouter } from \"react-router-dom\";\n\nimport { notification } from 'antd';\nimport \"antd/dist/antd.css\";\n\nimport Map from './Map.js'\nimport Spinner from './Spinner.js'\nimport CitySwitcherBackdrop from './CitySwitcherBackdrop.js'\nimport TopBar from './TopBar.js'\nimport MapStyleSwitcher from './MapStyleSwitcher.js'\nimport LayersPanel from './LayersPanel.js'\nimport OSMController from './OSMController.js'\nimport Storage from './Storage.js'\nimport { DEFAULT_LAT, DEFAULT_LNG, DEFAULT_ZOOM, OSM_DATA_MAX_AGE_MS } from './constants.js'\nimport { downloadObjectAsJson } from './utils.js'\nimport { computeTypologies, cleanUpOSMTags, calculateLayersLengths } from './geojsonUtils.js'\n\nimport './App.css';\n\nclass App extends Component {\n    geoJson;\n    storage;\n\n    constructor(props) {\n        super(props);\n\n        this.updateData = this.updateData.bind(this);\n        // this.onMapStyleChange = this.onMapStyleChange.bind(this);\n        this.onMapShowSatelliteChanged = this.onMapShowSatelliteChanged.bind(this);\n        this.onMapMoved = this.onMapMoved.bind(this);\n        this.onLayersChange = this.onLayersChange.bind(this);\n        this.downloadData = this.downloadData.bind(this);\n        this.forceUpdate = this.forceUpdate.bind(this);\n        this.onSpinnerClose = this.onSpinnerClose.bind(this);\n\n        const prev = this.getStateFromLocalStorage();\n\n        const urlParams = this.getParamsFromURL();\n        this.state = {\n            area: (prev && prev.area) || '',\n            showSatellite: (prev && prev.showSatellite) || false,\n            zoom: (prev && prev.zoom) || urlParams.z || DEFAULT_ZOOM,\n            center: [\n                (prev && prev.lng) || parseFloat(urlParams.lng) || DEFAULT_LNG,\n                (prev && prev.lat) || parseFloat(urlParams.lat) || DEFAULT_LAT],\n            geoJson: null,\n            loading: false,\n            mapStyle: 'mapbox://styles/cmdalbem/ck14cy14g1vb81cp8hprnh4nx',\n            layers: this.loadLayers(prev && prev.layersStates)\n        };\n\n        this.storage = new Storage();\n\n        if (this.state.area) {\n            this.updateData();\n        }\n\n        window.addEventListener('beforeunload', e => {\n            this.saveStateToLocalStorage();\n        });\n    }\n\n    loadLayers(layersStates) {\n        let layers = OSMController.getLayers();\n\n        // Merge with locally saved state\n        if (layersStates && Object.keys(layersStates).length > 0) {\n            layers.forEach(l => {\n                if (layersStates[l.id]) {\n                    l.isActive = layersStates[l.id];\n                }\n            });\n        }\n\n        return layers;\n    }\n\n    getStateFromLocalStorage() {\n        const savedState = JSON.parse(window.localStorage.getItem('appstate'));\n        console.debug('Retrived saved state from local storage:', savedState);\n        return savedState;\n    }\n\n    saveStateToLocalStorage() {\n        requestAnimationFrame( () => {\n            let layersStates = {};\n            this.state.layers.forEach(l => {\n                layersStates[l.id] = l.isActive;\n            });\n\n            const state = {\n                area: this.state.area,\n                showSatellite: this.state.showSatellite,\n                zoom: this.state.zoom,\n                lng: this.state.lng,\n                lat: this.state.lat,\n                layersStates: layersStates\n            }\n\n            let str = JSON.stringify(state);\n            window.localStorage.setItem('appstate', str);\n        });\n    }\n\n    getParamsFromURL() {\n        const possibleParams = ['z', 'lat', 'lng'];\n        const urlParams = new URLSearchParams(this.props.location.search);\n        let paramsObj = {}\n\n        possibleParams.forEach( p => {\n            let value = urlParams.get(p);\n            if (value) {\n                paramsObj[p] = value;\n            }\n        })\n\n        return paramsObj;\n    }\n\n    isDataFresh(data) {\n        const now = new Date();\n        const dataLastUpdate = new Date(data.updatedAt);\n\n        return now - dataLastUpdate < OSM_DATA_MAX_AGE_MS;\n    }\n\n    forceUpdate() {\n        this.updateData(true);\n    }\n\n    // geoJsonDiff(oldData, newData) {\n    //     console.debug('oldData', oldData);\n    //     console.debug('newData', newData);\n\n    //     let a = new Set(oldData.features.map(i => i.id));\n    //     let b = new Set(newData.features.map(i => i.id));        \n    //     // let a = new Set(oldData.features.map(i => JSON.stringify(i)));\n    //     // let b = new Set(newData.features.map(i => JSON.stringify(i)));\n\n    //     let a_minus_b = new Set([...a].filter(x => !b.has(x)));\n    //     let b_minus_a = new Set([...b].filter(x => !a.has(x)));\n    //     let a_intersect_b = new Set([...a].filter(x => b.has(x)));\n\n    //     // a_minus_b = [...a_minus_b].map(i => JSON.parse(i));\n    //     // b_minus_a = [...b_minus_a].map(i => JSON.parse(i));\n    //     // a_intersect_b = [...a_intersect_b].map(i => JSON.parse(i));\n    //     a_minus_b = [...a_minus_b];\n    //     b_minus_a = [...b_minus_a];\n    //     a_intersect_b = [...a_intersect_b];\n\n    //     console.debug('Removed:', a_minus_b);\n    //     console.debug('Added:', b_minus_a);\n    //     console.debug('Didnt change:', a_intersect_b);\n\n    //     notification.success({\n    //         message: 'Sucesso',\n    //         description:\n    //             a_minus_b.length === 0 && b_minus_a.length === 0 ?\n    //             <span>\n    //                 Não houve alterações no mapa cicloviários desde a última atualização.\n    //             </span>\n    //             :\n    //             <span>\n    //                 <b>{a_minus_b.length}</b> caminhos removidos e <b>{b_minus_a.length}</b> adicionados.\n    //             </span>\n    //     });\n    // }\n\n    isDataHealthy(oldData, newData) {\n        console.debug('oldData', oldData);\n        console.debug('newData', newData);\n\n        if (!oldData || !oldData.features) {\n            return true;\n        } else {\n            const nbrOldFeatures = oldData.features.length;\n            const nbrNewFeatures = newData.features.length;\n    \n            console.debug('nbrOldFeatures', nbrOldFeatures);\n            console.debug('nbrNewFeatures', nbrNewFeatures);\n    \n            return !(nbrNewFeatures === 0 || nbrNewFeatures < nbrOldFeatures*0.1);\n        }\n\n    }\n\n    getDataFromOSM(options = {}) {\n        const {areaName = this.state.area, forceUpdate} = options;\n\n        this.setState({ loading: true });\n\n        return OSMController.getData({ area: areaName })\n            .then(newData => {\n                // this.geoJsonDiff(this.state.geoJson, newData.geoJson);\n\n                if (forceUpdate && !this.isDataHealthy(this.state.geoJson, newData.geoJson)) {\n                    throw new Error('New data is not healthy.');\n                } else {\n                    const geoJsonWithTypes = computeTypologies(this.state.geoJson, this.state.layers);\n                    const lengths = calculateLayersLengths(geoJsonWithTypes, this.state.layers);\n\n                    this.storage.save(areaName, newData.geoJson, lengths)\n                        .then(() => {\n                            this.setState({\n                                geoJson: newData.geoJson,\n                                dataUpdatedAt: new Date(),\n                                loading: false,\n                                lengths: lengths\n                            });\n                        });\n                }\n            }).catch(e => {\n                console.error(e);\n                this.setState({\n                    error: true\n                });\n            });\n    }\n\n    updateData(forceUpdate) {\n        if (this.state.area) {\n            if (forceUpdate) {\n                this.getDataFromOSM({forceUpdate: true});\n            } else {\n                // Try to retrieve previously saved data for this area\n                this.storage.load(this.state.area)\n                    .then(data => {\n                        if (data) {\n                            console.debug('Database data is fresh.');\n                            this.setState({\n                                geoJson: data.geoJson,\n                                lengths: data.lengths,\n                                dataUpdatedAt: new Date(data.updatedAt)\n                            });\n                        } else { \n                            console.debug(`Couldn't find data for area ${this.state.area} or it isn't fresh, hitting OSM...`);\n                            this.getDataFromOSM();\n                        }\n                    }).catch(e => {\n                        notification['error']({\n                            message: 'Erro',\n                            description:\n                                'Ocorreu um erro ao acessar o banco de dados.',\n                        });\n                    });\n            }\n        } else {\n            this.setState({ loading: false });\n        }\n    }\n\n    // onMapStyleChange(newMapStyle) {\n    //     this.setState({ mapStyle: newMapStyle});\n    // }\n\n    onMapShowSatelliteChanged(showSatellite) {\n        this.setState({ showSatellite: showSatellite });\n    }\n\n    onLayersChange(id, newVal) {\n        let newLayers = Object.assign([], this.state.layers);\n        let modifiedLayer = newLayers.filter(l => l.id === id)[0];\n        modifiedLayer.isActive = newVal;\n\n        this.setState({ layers: newLayers });\n    }\n\n    downloadData() {\n        const geoJsonWithTypes = computeTypologies(this.state.geoJson, this.state.layers);\n        cleanUpOSMTags(geoJsonWithTypes);\n        downloadObjectAsJson(geoJsonWithTypes, `ciclomapa-${this.state.area}`);\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        if (this.props.location !== prevProps.location) {\n            this.onRouteChanged();\n        }\n\n        if (this.state.area !== prevState.area) {\n            console.debug(`Changed area from ${prevState.area} to ${this.state.area}`);\n            \n            this.updateData();\n\n            // Only redo the query if we need new data\n            // if (!doesAContainsB(largestBoundsYet, newBounds)) {\n            //     this.updateData();\n            //     largestBoundsYet = newBounds;\n\n            //     if (DEBUG_BOUNDS_OPTIMIZATION) {\n            //         this.updateDebugPolygon(largestBoundsYet, 1);\n            //     }\n            // }\n        }\n\n        if (this.state.geoJson !== prevState.geoJson) {\n            if (!this.state.geoJson || (this.state.geoJson.features && this.state.geoJson.features.length === 0)) {\n                notification['warning']({\n                    message: 'Ops',\n                    description:\n                        'Não há dados cicloviários para esta cidade.',\n                });\n            } else {\n                // Retrocompatibility case where lengths weren't save to database\n                if (!this.state.lengths) {\n                    const geoJsonWithTypes = computeTypologies(this.state.geoJson, this.state.layers);\n                    const lengths = calculateLayersLengths(geoJsonWithTypes, this.state.layers);\n                    \n                    this.setState({\n                        lengths: lengths\n                    });\n                }\n            }\n        }\n        \n        if (this.state.zoom !== prevState.zoom ||\n            this.state.lat !== prevState.lat ||\n            this.state.lng !== prevState.lng) {\n                let params = '?';\n                params += `lat=${this.state.lat.toFixed(7)}`;\n                params += `&lng=${this.state.lng.toFixed(7)}`;\n                params += `&z=${this.state.zoom.toFixed(2)}`;\n                this.props.history.push({\n                    search: params\n                })\n        }\n    }\n\n    onRouteChanged() {\n        // @todo Fix infinite loop\n        // this.setState(this.getParamsFromURL());\n    }\n\n    onMapMoved(newState) {\n        // Ignore new area changes from Map\n        // if (this.state.area) {\n        //     delete newState.area;\n        // }\n\n        requestAnimationFrame(() => {\n            this.setState(newState);\n        });\n    }\n\n    onSpinnerClose() {\n        this.setState({\n            error: false,\n            loading: false\n        });\n    }\n\n    render() {\n        return (\n            <div>\n                <TopBar\n                    title={this.state.area}\n                    lastUpdate={this.state.dataUpdatedAt}\n                    downloadData={this.downloadData}\n                    // isDownloadUnavailable={this.state.isDownloadUnavailable}\n                    onMapMoved={this.onMapMoved}\n                    forceUpdate={this.forceUpdate}\n                />\n\n                <CitySwitcherBackdrop/>\n\n                <Map\n                    ref={(map) => { window.map = map }}\n                    data={this.state.geoJson}\n                    layers={this.state.layers}\n                    style={this.state.mapStyle}\n                    zoom={this.state.zoom}\n                    center={this.state.center}\n                    showSatellite={this.state.showSatellite}\n                    updateData={this.updateData}\n                    onMapMoved={this.onMapMoved}\n                    updateLengths={this.updateLengths}\n                />\n\n                <div id=\"gradient-backdrop\"/>\n\n                <MapStyleSwitcher \n                    showSatellite={this.state.showSatellite}\n                    onMapShowSatelliteChanged={this.onMapShowSatelliteChanged}\n                />\n \n                <LayersPanel\n                    layers={this.state.layers}\n                    lengths={this.state.lengths}\n                    onLayersChange={this.onLayersChange}\n                />\n\n                {\n                    this.state.loading &&\n                    <Spinner\n                        area={this.state.area}\n                        error={this.state.error}\n                        onClose={this.onSpinnerClose}\n                    />\n                }\n            </div>\n        );\n    }\n}\n\nconst withRouterAndRef = Wrapped => {\n    const WithRouter = withRouter(({ forwardRef, ...otherProps }) => (\n        <Wrapped ref={forwardRef} {...otherProps} />\n    ))\n    const WithRouterAndRef = React.forwardRef((props, ref) => (\n        <WithRouter {...props} forwardRef={ref} />\n    ))\n    const name = Wrapped.displayName || Wrapped.name\n    WithRouterAndRef.displayName = `withRouterAndRef(${name})`\n    return WithRouterAndRef\n}\n\nexport default withRouterAndRef(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nimport { BrowserRouter as Router } from \"react-router-dom\";\n\nReactDOM.render(\n  <Router>\n    <App ref={(app) => { window.ciclomapa = app }}/>\n  </Router>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();"],"sourceRoot":""}